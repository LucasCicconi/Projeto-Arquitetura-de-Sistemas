.CODE
	LDLI R1,#00H
	LDHI R1,#01H
	LDSP R1
	LDLI R1,#0F3H
	LDHI R1,#23H
	LDLI R2,#52H
	LDHI R2,#0E2H
	LDLI R3,#00H
	LDHI R3,#8FH
	ADD R4,R1,R2     ;R4 <- 23F3 + E252  = (C) 0645
	SUB R5,R1,R2     ;R5 <- 23F3 - E252  = (C) 41A1
	AND R6,R3,R1     ;R6 <- 8F00 and 23F3 = 0300
	OR R7,R4,R5      ;R7 <- 0645 or 41A1  = 47E5
	SUB R5,R1,R1     ;R5 <- 0  (C) (Z)
	ADDI R1,#0ABH
	SUBI R1,#0ABH
	STMSK #0FFH
	JSRMI #SOMAVET  
	NOP
	NOP
	NOP
	NOP
	NOP
	STMSK #0FFH
	JSRMI #TESTESHIFT
	HALT

	SOMAVET: PUSH R1     ; -- pula para cá!
	PUSH R2
	PUSH R3
	PUSH R4
	PUSH R5
	PUSH R6
	PUSH R7
	XOR R5,R5,R5
	LDLI R1,#END1
	LDHI R1,#END1
	LDLI R2,#END2
	LDHI R2,#END2
	LDLI R3,#END3
	LDHI R3,#END3
	LDLI R4 #N
	LDHI R4,#N
	LD R4,R4,R5
	LOOP: LD R6,R1,R5
	LD R7,R2,R5
	ADD R7,R6,R7
	ST R3,R7
	ADDI R5,#01H
	ADDI R3,#01H
	SUBI R4,#01H
	STMSK #10H
	JPMI #LOOP
	POP R7
	POP R6
	POP R5
	POP R4
	POP R3
	POP R2
	POP R1
	RTS                     

	TESTESHIFT: PUSH R1     ;-- ok até aqui
	PUSH R2
	PUSH R3
	LDLI R1,#55H
	LDHI R1,#AAH
	NOT R1,R1
	SL R2,R1
	SL R2,R2
	SR R3,R1
	SR R3,R3
	MOV R1, R4  ; R1<- R3                ; *** novo
	MOVSP R1 ;< SP  (FC neste caso)     ; *** novo
	;LDIM    ;   primeiro parâmetro abaixo da pilha
	POP R3
	POP R2
	POP R1
	RTS
.ENDCODE
.DATA
N: DB #0008H
END1: DB #0003H,#0018H,#0035H,#00ABH,#00CDH,#0077H,#0053H,#0045H
END2: DB #0067H,#0034H,#0021H,#00BFH,#000FH,#00FDH,#0011H,#0001H
END3: DB #0000H
.ENDDATA
